// This code (SQL/python) is used for Finished Product DFC calculation in specific DC's (only where are two per single SMO/CTRY) on any given day from initial SOG (and forward calculation of supply and demand) the query is based on SOG from dp_inventory and demand and supply from dp_rapidresponse.emea_sca_detail_duedate
// The code checks initial SOG and based on query setup adds supply (Home Care used firm supply) and demand (forecast + open orders) calculating initial SOG for each day.
// In the next step code calculates how many days forward demand it can cover from SOG on a specific day.
//
// Query is mix of SQL and python. In the for of powerbi_dataflows look for: ADA_Manange_My DFC.ipynb for iPython Notebook and ADA_Manage_My DFC.py for source code.
//
// Tables should be connected between each other on _REF_FPC_DC and externally on Date and FPC matrix
//
// For quality of input data based on which calculation was performed: userdb_skora_m_1.ada_hc_rr_timestamp (rapidresponse timestamp is checked inventory_dfc_rapidresponse_refresh_timestamp)
// 
// or can be mounted in dataflow directly - DFC query runs on 08:40 CEST


let
    Source = Value.NativeQuery(Databricks.Catalogs("adb-8755884253711570.10.azuredatabricks.net", "sql/protocolv1/o/8755884253711570/1110-205946-addle823", [Catalog="hive_metastore", Database=null, EnableAutomaticProxyDiscovery=null]){[Name="hive_metastore",Kind="Database"]}[Data], "SELECT MAX(`timestamp`) as rapidrespomse_emea_refresh_timestamp_CET FROM (DESCRIBE HISTORY dp_rapidresponse.emea_sca_detail_duedate)", null, [EnableFolding=true]),
    DateTimeCol = Source[rapidrespomse_emea_refresh_timestamp_CET]{0}, // Pobieranie wartości DateTime
    ConvertToCEST = DateTimeZone.SwitchZone(DateTimeZone.From(DateTimeCol), 2), // Przesunięcie do CEST
    Result = ConvertToCEST
in
    Result
