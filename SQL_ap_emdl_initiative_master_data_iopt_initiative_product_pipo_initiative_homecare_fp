WITH RankedData AS (
    SELECT iopt_initiative_product_lifecycle_id, iopt_initiative_id, life_cycle_scope, initiative_pi_material_id, initiative_po_material_id, iopt_initiative_name, iopt_initiative_description, dsbp_initiative_id, dsbp_initiative_name, reference_product_material_id, initiative_introduction_discontinuation, life_cycle_name, iol_name, iopt_initiative_region_value, iopt_initiative_archived_region_value_description as iopt_initiative_region_description, iopt_initiative_subsector_value, iopt_initiative_subsector_description, iopt_initiative_subsector_long_description, product_subsector_value, product_subsector_description, product_category_value, product_category_description, product_brand_value, product_brand_description, start_of_shipment_date, last_shipment_date, initiative_pi_material_description, pi_segment, initiative_po_material_description, initiative_po_segment, customer_conversion, pg_conversion, pg_conversion_at_end, initiative_sap_start_of_shipment_date, iopt_initiative_iopt_user_sos_date, iopt_initiative_iopt_current_sos_date, aloha_sos_date, start_of_window, end_of_window, start_of_2nd_window, end_of_2nd_window, aloha_pi_forecast_switch_date, user_pi_forecast_switch_date, aloha_po_forecast_switch_date, initiative_eos, initiative_end_of_promotion, initiative_stock_on_ground, lifecycle_stage, initiative_pi_pallet_type, initiative_po_pallet_type, initiative_pi_cu_gtin, initiative_pi_cu_gross_weight, initiative_pi_cu_weight_unit, initiative_pi_cu_length, initiative_pi_cu_width, initiative_pi_cu_height, initiative_pi_cu_unit_of_dimension, initiative_pi_cu_volume, initiative_pi_cu_volume_unit, initiative_pi_sw_gtin, initiative_pi_sw_gross_weight, initiative_pi_sw_weight_unit, initiative_pi_sw_length, initiative_pi_sw_width, initiative_pi_sw_height, initiative_pi_sw_unit_of_dimension, initiative_pi_sw_volume, initiative_pi_sw_volume_unit, initiative_pi_cs_gtin, initiative_pi_cs_gross_weight, initiative_pi_cs_weight_unit, initiative_pi_cs_length, initiative_pi_cs_width, initiative_pi_cs_height, initiative_pi_cs_dimension_unit, initiative_pi_cs_volume, initiative_pi_cs_volume_unit, initiative_pi_buom, initiative_po_cu_gtin, initiative_po_sw_gtin, initiative_po_cs_gtin, initiative_po_buom, product_type_of_change_id, product_type_of_change_e_content, initiative_bu_custom_field1, initiative_bu_custom_field2, initiative_bu_custom_field3, initiative_mil_feedback, initiative_snp_controller, initiative_not_for_sale_indicator, initiative_cpe, company_code, initiative_gdm_indicator, pi_product_cu_auom, po_product_cu_auom, iopt_initiative_archive_date, iopt_initiative_source, initiative_urgent_ipsr_request, initiative_certification_claim, initiative_pi_forecast_switch_date, initiative_po_forecast_switch_date, initiative_pallet_gtin_in, initiative_pallet_gtin_out, initiative_ship_from_dc, iopt_initiative_creation_date, iopt_last_modification_date, life_cycle_inclusion_date, product_inclusion_date, initiative_pi_po_material_id, iopt_initiative_product_id, create_date, update_date, secure_group_key, process_run_key, data_provider_code, ROW_NUMBER() OVER (PARTITION BY iopt_initiative_product_lifecycle_id, iopt_initiative_id, life_cycle_scope, initiative_pi_material_id, initiative_po_material_id, iopt_initiative_name, iopt_initiative_description, dsbp_initiative_id, dsbp_initiative_name, reference_product_material_id, initiative_introduction_discontinuation, life_cycle_name, iol_name, iopt_initiative_subsector_value, iopt_initiative_subsector_description, iopt_initiative_subsector_long_description, product_subsector_value, product_subsector_description, product_category_value, product_category_description, product_brand_value, product_brand_description, start_of_shipment_date, last_shipment_date, initiative_pi_material_description, pi_segment, initiative_po_material_description, initiative_po_segment, customer_conversion, pg_conversion, pg_conversion_at_end, initiative_sap_start_of_shipment_date, iopt_initiative_iopt_user_sos_date, iopt_initiative_iopt_current_sos_date, aloha_sos_date, start_of_window, end_of_window, start_of_2nd_window, end_of_2nd_window, aloha_pi_forecast_switch_date, user_pi_forecast_switch_date, aloha_po_forecast_switch_date, initiative_eos, initiative_end_of_promotion, initiative_stock_on_ground, lifecycle_stage, initiative_pi_pallet_type, initiative_po_pallet_type, initiative_pi_cu_gtin, initiative_pi_cu_gross_weight, initiative_pi_cu_weight_unit, initiative_pi_cu_length, initiative_pi_cu_width, initiative_pi_cu_height, initiative_pi_cu_unit_of_dimension, initiative_pi_cu_volume, initiative_pi_cu_volume_unit, initiative_pi_sw_gtin, initiative_pi_sw_gross_weight, initiative_pi_sw_weight_unit, initiative_pi_sw_length, initiative_pi_sw_width, initiative_pi_sw_height, initiative_pi_sw_unit_of_dimension, initiative_pi_sw_volume, initiative_pi_sw_volume_unit, initiative_pi_cs_gtin, initiative_pi_cs_gross_weight, initiative_pi_cs_weight_unit, initiative_pi_cs_length, initiative_pi_cs_width, initiative_pi_cs_height, initiative_pi_cs_dimension_unit, initiative_pi_cs_volume, initiative_pi_cs_volume_unit, initiative_pi_buom, initiative_po_cu_gtin, initiative_po_sw_gtin, initiative_po_cs_gtin, initiative_po_buom, product_type_of_change_id, product_type_of_change_e_content, initiative_bu_custom_field1, initiative_bu_custom_field2, initiative_bu_custom_field3, initiative_mil_feedback, initiative_snp_controller, initiative_not_for_sale_indicator, initiative_cpe, company_code, initiative_gdm_indicator, pi_product_cu_auom, po_product_cu_auom, iopt_initiative_archive_date, iopt_initiative_source, initiative_urgent_ipsr_request, initiative_certification_claim, initiative_pi_forecast_switch_date, initiative_po_forecast_switch_date, initiative_pallet_gtin_in, initiative_pallet_gtin_out, initiative_ship_from_dc, iopt_initiative_creation_date, iopt_last_modification_date, life_cycle_inclusion_date, product_inclusion_date, initiative_pi_po_material_id, iopt_initiative_product_id, create_date, update_date, secure_group_key, process_run_key, data_provider_code ORDER BY iopt_initiative_region_value_valid_to DESC) as rn
    FROM ap_emdl_initiative_archived_master_data.iopt_initiative_product_pipo_archived WHERE iopt_initiative_subsector_value = 'HOM' AND iopt_initiative_region_value IN ('GLOBAL', 'REU', 'RMA', 'XT')
),

CurrentData AS (
    SELECT distinct 
           iopt_initiative_product_lifecycle_id, iopt_initiative_id, life_cycle_scope, initiative_pi_material_id, initiative_po_material_id, iopt_initiative_name, iopt_initiative_description, dsbp_initiative_id, dsbp_initiative_name, reference_product_material_id, initiative_introduction_discontinuation, life_cycle_name, iol_name, iopt_initiative_region_value, iopt_initiative_region_description, iopt_initiative_subsector_value, iopt_initiative_subsector_description, iopt_initiative_subsector_long_description, product_subsector_value, product_subsector_description, product_category_value, product_category_description, product_brand_value, product_brand_description, start_of_shipment_date, last_shipment_date, initiative_pi_material_description, pi_segment, initiative_po_material_description, initiative_po_segment, customer_conversion, pg_conversion, pg_conversion_at_end, initiative_sap_start_of_shipment_date, iopt_initiative_iopt_user_sos_date, iopt_initiative_iopt_current_sos_date, aloha_sos_date, start_of_window, end_of_window, start_of_2nd_window, end_of_2nd_window, aloha_pi_forecast_switch_date, user_pi_forecast_switch_date, aloha_po_forecast_switch_date, initiative_eos, initiative_end_of_promotion, initiative_stock_on_ground, lifecycle_stage, initiative_pi_pallet_type, initiative_po_pallet_type, initiative_pi_cu_gtin, initiative_pi_cu_gross_weight, initiative_pi_cu_weight_unit, initiative_pi_cu_length, initiative_pi_cu_width, initiative_pi_cu_height, initiative_pi_cu_unit_of_dimension, initiative_pi_cu_volume, initiative_pi_cu_volume_unit, initiative_pi_sw_gtin, initiative_pi_sw_gross_weight, initiative_pi_sw_weight_unit, initiative_pi_sw_length, initiative_pi_sw_width, initiative_pi_sw_height, initiative_pi_sw_unit_of_dimension, initiative_pi_sw_volume, initiative_pi_sw_volume_unit, initiative_pi_cs_gtin, initiative_pi_cs_gross_weight, initiative_pi_cs_weight_unit, initiative_pi_cs_length, initiative_pi_cs_width, initiative_pi_cs_height, initiative_pi_cs_dimension_unit, initiative_pi_cs_volume, initiative_pi_cs_volume_unit, initiative_pi_buom, initiative_po_cu_gtin, initiative_po_sw_gtin, initiative_po_cs_gtin, initiative_po_buom, product_type_of_change_id, product_type_of_change_e_content, initiative_bu_custom_field1, initiative_bu_custom_field2, initiative_bu_custom_field3, initiative_mil_feedback, initiative_snp_controller, initiative_not_for_sale_indicator, initiative_cpe, company_code, initiative_gdm_indicator, pi_product_cu_auom, po_product_cu_auom, iopt_initiative_archive_date, iopt_initiative_source, initiative_urgent_ipsr_request, initiative_certification_claim, initiative_pi_forecast_switch_date, initiative_po_forecast_switch_date, initiative_pallet_gtin_in, initiative_pallet_gtin_out, initiative_ship_from_dc, iopt_initiative_creation_date, iopt_last_modification_date, life_cycle_inclusion_date, product_inclusion_date, initiative_pi_po_material_id, iopt_initiative_product_id, create_date, update_date, secure_group_key, process_run_key, data_provider_code
    FROM ap_emdl_initiative_master_data.iopt_initiative_product_pipo WHERE iopt_initiative_subsector_value = 'HOM' AND iopt_initiative_region_value IN ('GLOBAL', 'REU', 'RMA', 'XT')
)

SELECT iopt_initiative_product_lifecycle_id, iopt_initiative_id, life_cycle_scope, initiative_pi_material_id, initiative_po_material_id, iopt_initiative_name, iopt_initiative_description, dsbp_initiative_id, dsbp_initiative_name, reference_product_material_id, initiative_introduction_discontinuation, life_cycle_name, iol_name, iopt_initiative_region_value, iopt_initiative_region_description, iopt_initiative_subsector_value, iopt_initiative_subsector_description, iopt_initiative_subsector_long_description, product_subsector_value, product_subsector_description, product_category_value, product_category_description, product_brand_value, product_brand_description, start_of_shipment_date, last_shipment_date, initiative_pi_material_description, pi_segment, initiative_po_material_description, initiative_po_segment, customer_conversion, pg_conversion, pg_conversion_at_end, initiative_sap_start_of_shipment_date, iopt_initiative_iopt_user_sos_date, iopt_initiative_iopt_current_sos_date, aloha_sos_date, start_of_window, end_of_window, start_of_2nd_window, end_of_2nd_window, aloha_pi_forecast_switch_date, user_pi_forecast_switch_date, aloha_po_forecast_switch_date, initiative_eos, initiative_end_of_promotion, initiative_stock_on_ground, lifecycle_stage, initiative_pi_pallet_type, initiative_po_pallet_type, initiative_pi_cu_gtin, initiative_pi_cu_gross_weight, initiative_pi_cu_weight_unit, initiative_pi_cu_length, initiative_pi_cu_width, initiative_pi_cu_height, initiative_pi_cu_unit_of_dimension, initiative_pi_cu_volume, initiative_pi_cu_volume_unit, initiative_pi_sw_gtin, initiative_pi_sw_gross_weight, initiative_pi_sw_weight_unit, initiative_pi_sw_length, initiative_pi_sw_width, initiative_pi_sw_height, initiative_pi_sw_unit_of_dimension, initiative_pi_sw_volume, initiative_pi_sw_volume_unit, initiative_pi_cs_gtin, initiative_pi_cs_gross_weight, initiative_pi_cs_weight_unit, initiative_pi_cs_length, initiative_pi_cs_width, initiative_pi_cs_height, initiative_pi_cs_dimension_unit, initiative_pi_cs_volume, initiative_pi_cs_volume_unit, initiative_pi_buom, initiative_po_cu_gtin, initiative_po_sw_gtin, initiative_po_cs_gtin, initiative_po_buom, product_type_of_change_id, product_type_of_change_e_content, initiative_bu_custom_field1, initiative_bu_custom_field2, initiative_bu_custom_field3, initiative_mil_feedback, initiative_snp_controller, initiative_not_for_sale_indicator, initiative_cpe, company_code, initiative_gdm_indicator, pi_product_cu_auom, po_product_cu_auom, iopt_initiative_archive_date, iopt_initiative_source, initiative_urgent_ipsr_request, initiative_certification_claim, initiative_pi_forecast_switch_date, initiative_po_forecast_switch_date, initiative_pallet_gtin_in, initiative_pallet_gtin_out, initiative_ship_from_dc, iopt_initiative_creation_date, iopt_last_modification_date, life_cycle_inclusion_date, product_inclusion_date, initiative_pi_po_material_id, iopt_initiative_product_id, create_date, update_date, secure_group_key, process_run_key, data_provider_code FROM RankedData
WHERE rn = 1
UNION ALL
SELECT * FROM CurrentData;
