-- 1/ NEXT MONTH BOP DATE

SELECT DAY_NUM
FROM idpdm.MD_TIME_FDIM
WHERE DAY_DATE BETWEEN 
  (SELECT MTH_START_DATE FROM idpdm.MD_TIME_FDIM WHERE DAY_DATE = CURRENT_DATE())
  AND
  (SELECT MTH_END_DATE FROM idpdm.MD_TIME_FDIM WHERE DAY_DATE = CURRENT_DATE())
  AND DAY_OF_WK_NAME = 'MONDAY'
  AND SOP_FLAG = 'Y'
LIMIT 1;


-- 2/ CURRENT MONTH BOP DATE

SELECT DAY_NUM
FROM idpdm.MD_TIME_FDIM
WHERE DAY_DATE BETWEEN 
  (SELECT MTH_START_DATE - INTERVAL '1 MONTH' FROM idpdm.MD_TIME_FDIM WHERE DAY_DATE = CURRENT_DATE)
  AND
  (SELECT MTH_END_DATE - INTERVAL '1 MONTH' FROM idpdm.MD_TIME_FDIM WHERE DAY_DATE = CURRENT_DATE)
  AND DAY_OF_WK_NAME = 'MONDAY'
  AND SOP_FLAG = 'Y'
LIMIT 1;


-- 3/ PREVIOUS MONTH BOP DATE

SELECT DAY_NUM
FROM idpdm.MD_TIME_FDIM
WHERE DAY_DATE BETWEEN 
  (SELECT MTH_START_DATE - INTERVAL '2 MONTH' FROM idpdm.MD_TIME_FDIM WHERE DAY_DATE = CURRENT_DATE)
  AND
  (SELECT MTH_END_DATE - INTERVAL '2 MONTH' FROM idpdm.MD_TIME_FDIM WHERE DAY_DATE = CURRENT_DATE)
  AND DAY_OF_WK_NAME = 'MONDAY'
  AND SOP_FLAG = 'Y'
LIMIT 1;



-- 4/ CURRENT FY WITHOUT CURRENT MONTH

WITH date_range AS (
  SELECT DISTINCT FISC_YR_START_DATE, DATE_TRUNC('month', CURRENT_DATE) - INTERVAL '1 day' AS PREV_MTH_END_DATE
  FROM idpdm.MD_TIME_FDIM
  WHERE DAY_DATE = CURRENT_DATE
)
SELECT DAY_NUM
FROM idpdm.MD_TIME_FDIM
WHERE DAY_DATE BETWEEN (SELECT FISC_YR_START_DATE FROM date_range) AND (SELECT PREV_MTH_END_DATE FROM date_range);



-- 5/ PREVIOUS FY

WITH date_range AS (
  SELECT DISTINCT FISC_YR_START_DATE - INTERVAL '1 YEAR' AS START_DATE, FISC_YR_END_DATE - INTERVAL '1 YEAR' AS END_DATE
  FROM idpdm.MD_TIME_FDIM
  WHERE DAY_DATE = CURRENT_DATE
)
SELECT DAY_NUM
FROM idpdm.MD_TIME_FDIM
WHERE DAY_DATE BETWEEN (SELECT START_DATE FROM date_range) AND (SELECT END_DATE FROM date_range);



-- 6/ PREV_PREV FY

WITH date_range AS (
  SELECT DISTINCT FISC_YR_START_DATE - INTERVAL '2 YEAR' AS START_DATE, FISC_YR_END_DATE - INTERVAL '2 YEAR' AS END_DATE
  FROM idpdm.MD_TIME_FDIM
  WHERE DAY_DATE = CURRENT_DATE
)
SELECT DAY_NUM
FROM idpdm.MD_TIME_FDIM
WHERE DAY_DATE BETWEEN (SELECT START_DATE FROM date_range) AND (SELECT END_DATE FROM date_range);


-- 7/ CURRENT MONTH

SELECT DAY_NUM
FROM idpdm.MD_TIME_FDIM
WHERE DAY_DATE BETWEEN DATE_TRUNC('MONTH', CURRENT_DATE) AND (DATE_TRUNC('MONTH', CURRENT_DATE) + INTERVAL '1 MONTH' - INTERVAL '1 DAY');


-- 8/ PREV MONTH

SELECT DAY_NUM
FROM idpdm.MD_TIME_FDIM
WHERE DAY_DATE BETWEEN (DATE_TRUNC('MONTH', CURRENT_DATE) - INTERVAL '1 MONTH') AND (DATE_TRUNC('MONTH', CURRENT_DATE) - INTERVAL '1 DAY');


-- 9/ NEXT MONTH

SELECT DAY_NUM
FROM idpdm.MD_TIME_FDIM
WHERE DAY_DATE BETWEEN (DATE_TRUNC('MONTH', CURRENT_DATE) + INTERVAL '1 MONTH') AND (DATE_TRUNC('MONTH', CURRENT_DATE) + INTERVAL '2 MONTHS' - INTERVAL '1 DAY');


-- 10/ NEXT 12 MONTHS FROM CURRENT MONTH START DATE

WITH date_range AS (
  SELECT MTH_START_DATE AS START_DATE, MTH_END_DATE + INTERVAL '12 MONTHS' - INTERVAL '1 DAY' AS END_DATE
  FROM idpdm.MD_TIME_FDIM
  WHERE DAY_DATE = CURRENT_DATE
)
SELECT DAY_NUM
FROM idpdm.MD_TIME_FDIM
WHERE DAY_DATE BETWEEN (SELECT START_DATE FROM date_range) AND (SELECT END_DATE FROM date_range);


-- 11/ NEXT 13 WEEKS

WITH date_range AS (
  SELECT WK_START_DATE AS START_DATE, (WK_START_DATE + INTERVAL '12 weeks' + INTERVAL '6 days') AS END_DATE
  FROM idpdm.MD_TIME_FDIM
  WHERE DAY_DATE = CURRENT_DATE
)
SELECT DAY_NUM
FROM idpdm.MD_TIME_FDIM
WHERE DAY_DATE BETWEEN (SELECT START_DATE FROM date_range) AND (SELECT END_DATE FROM date_range);


